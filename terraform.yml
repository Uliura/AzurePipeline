---
steps:
  - task: TerraformTaskV2@2
    inputs:
      provider: "azurerm"
      command: "init"
      backendServiceArm: 'AzureSC'
      backendAzureRmResourceGroupName: "AzureDevOps"
      backendAzureRmStorageAccountName: "storadgeforazuredevops"
      backendAzureRmContainerName: "tfstate"
      backendAzureRmKey: "terraform.tfstate"
  - task: TerraformTaskV2@2
    inputs:
      provider: "azurerm"
      command: "plan"
      commandOptions: '-out=tfplan -input=false -var "SQL_PASSWORD=$(TF_VAR_SQL_PASSWORD)"'
      environmentServiceNameAzureRM: 'AzureSC'
  - task: TerraformTaskV2@2
    inputs:
      provider: "azurerm"
      command: "apply"
      commandOptions: "tfplan"
      environmentServiceNameAzureRM: 'AzureSC'
